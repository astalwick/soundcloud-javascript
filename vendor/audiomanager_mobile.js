(function(e,t){if(typeof module!=="undefined"&&module.exports){module.exports=t()}else{e.AudioManager=t()}})(this,function(){var e,t,n;(function(r){function d(e,t){return h.call(e,t)}function v(e,t){var n,r,i,s,o,u,a,f,c,h,p=t&&t.split("/"),d=l.map,v=d&&d["*"]||{};if(e&&e.charAt(0)==="."){if(t){p=p.slice(0,p.length-1);e=p.concat(e.split("/"));for(f=0;f<e.length;f+=1){h=e[f];if(h==="."){e.splice(f,1);f-=1}else if(h===".."){if(f===1&&(e[2]===".."||e[0]==="..")){break}else if(f>0){e.splice(f-1,2);f-=2}}}e=e.join("/")}else if(e.indexOf("./")===0){e=e.substring(2)}}if((p||v)&&d){n=e.split("/");for(f=n.length;f>0;f-=1){r=n.slice(0,f).join("/");if(p){for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i;o=f;break}}}}if(s){break}if(!u&&v&&v[r]){u=v[r];a=f}}if(!s&&u){s=u;o=a}if(s){n.splice(0,o,s);e=n.join("/")}}return e}function m(e,t){return function(){return s.apply(r,p.call(arguments,0).concat([e,t]))}}function g(e){return function(t){return v(t,e)}}function y(e){return function(t){a[e]=t}}function b(e){if(d(f,e)){var t=f[e];delete f[e];c[e]=true;i.apply(r,t)}if(!d(a,e)&&!d(c,e)){throw new Error("No "+e)}return a[e]}function w(e){var t,n=e?e.indexOf("!"):-1;if(n>-1){t=e.substring(0,n);e=e.substring(n+1,e.length)}return[t,e]}function E(e){return function(){return l&&l.config&&l.config[e]||{}}}var i,s,o,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice;o=function(e,t){var n,r=w(e),i=r[0];e=r[1];if(i){i=v(i,t);n=b(i)}if(i){if(n&&n.normalize){e=n.normalize(e,g(t))}else{e=v(e,t)}}else{e=v(e,t);r=w(e);i=r[0];e=r[1];if(i){n=b(i)}}return{f:i?i+"!"+e:e,n:e,pr:i,p:n}};u={require:function(e){return m(e)},exports:function(e){var t=a[e];if(typeof t!=="undefined"){return t}else{return a[e]={}}},module:function(e){return{id:e,uri:"",exports:a[e],config:E(e)}}};i=function(e,t,n,i){var s,l,h,p,v,g=[],w;i=i||e;if(typeof n==="function"){t=!t.length&&n.length?["require","exports","module"]:t;for(v=0;v<t.length;v+=1){p=o(t[v],i);l=p.f;if(l==="require"){g[v]=u.require(e)}else if(l==="exports"){g[v]=u.exports(e);w=true}else if(l==="module"){s=g[v]=u.module(e)}else if(d(a,l)||d(f,l)||d(c,l)){g[v]=b(l)}else if(p.p){p.p.load(p.n,m(i,true),y(l),{});g[v]=a[l]}else{throw new Error(e+" missing "+l)}}h=n.apply(a[e],g);if(e){if(s&&s.exports!==r&&s.exports!==a[e]){a[e]=s.exports}else if(h!==r||!w){a[e]=h}}}else if(e){a[e]=n}};e=t=s=function(e,t,n,a,f){if(typeof e==="string"){if(u[e]){return u[e](t)}return b(o(e,t).f)}else if(!e.splice){l=e;if(t.splice){e=t;t=n;n=null}else{e=r}}t=t||function(){};if(typeof n==="function"){n=a;a=f}if(a){i(r,e,t,n)}else{setTimeout(function(){i(r,e,t,n)},4)}return s};s.config=function(e){l=e;if(l.deps){s(l.deps,l.callback)}return s};n=function(e,t,n){if(!t.splice){n=t;t=[]}if(!d(a,e)&&!d(f,e)){f[e]=[e,t,n]}};n.amd={jQuery:true}})();n("vendor/almond",function(){});!function(e){function t(e,t,n){if(!e||!O[typeof e])return e;t=t&&typeof n=="undefined"?t:u.createCallback(t,n);var r=e.length;if(n=-1,r&&l(e))for(;++n<r&&(n+="",false!==t(e[n],n,e)););else for(n in r=typeof e=="function",e)if((!r||"prototype"!=n)&&false===t(e[n],n,e))break;return e}function r(e,t,n){var r,i=e,s=i;if(!i)return s;var o=arguments,a=0,f=typeof n=="number"?2:o.length;if(3<f&&"function"==typeof o[f-2])var c=u.createCallback(o[--f-1],o[f--],2);else 2<f&&"function"==typeof o[f-1]&&(c=o[--f]);for(;++a<f;)if((i=o[a])&&O[typeof i]){var h=i.length;if(r=-1,h&&l(i))for(;++r<h;)r+="",s[r]=c?c(s[r],i[r]):i[r];else for(r in h=typeof i=="function",i)h&&"prototype"==r||!B.call(i,r)||(s[r]=c?c(s[r],i[r]):i[r])}return s}function i(e){var t,n=[];if(!e||!O[typeof e])return n;var r=e.length;if(t=-1,r&&l(e))for(;++t<r;)t+="",n.push(t);else for(t in r=typeof e=="function",e)r&&"prototype"==t||!B.call(e,t)||n.push(t);return n}function s(){}function o(e){e.length=0,y.length<E&&y.push(e)}function u(){}function a(e,t,n){function r(){var a=arguments,l=s?this:t;return i||(e=t[o]),n.length&&(a=a.length?(a=z.call(a),u?a.concat(n):n.concat(a)):n),this instanceof r?(l=f(e.prototype),a=e.apply(l,a),d(a)?a:l):e.apply(l,a)}var i=p(e),s=!n,o=t;if(s){var u=void 0;n=t}else if(!i)throw new TypeError;return r}function f(e){return d(e)?q(e):{}}function l(e){return F.call(e)==S}function c(e){var n=[];return t(e,function(e,t){p(e)&&n.push(t)}),n.sort()}function h(e,n,r,i,s,a){var f=r===w;if(typeof r=="function"&&!f){r=u.createCallback(r,i,2);var l=r(e,n);if(typeof l!="undefined")return!!l}if(e===n)return 0!==e||1/e==1/n;var c=typeof e,d=typeof n;if(e===e&&(!e||"function"!=c&&"object"!=c)&&(!n||"function"!=d&&"object"!=d))return!1;if(null==e||null==n)return e===n;if(d=F.call(e),c=F.call(n),d==S&&(d=k),c==S&&(c=k),d!=c)return!1;switch(d){case T:case N:return+e==+n;case C:return e!=+e?n!=+n:0==e?1/e==1/n:e==+n;case L:case A:return e==n+""}if(c=d==x,!c){if(B.call(e,"__wrapped__")||B.call(n,"__wrapped__"))return h(e.__wrapped__||e,n.__wrapped__||n,r,i,s,a);if(d!=k)return!1;var d=e.constructor,v=n.constructor;if(d!=v&&!(p(d)&&d instanceof d&&p(v)&&v instanceof v))return!1}for(v=!s,s||(s=y.pop()||[]),a||(a=y.pop()||[]),d=s.length;d--;)if(s[d]==e)return a[d]==n;var m=0,l=!0;if(s.push(e),a.push(n),c){if(d=e.length,m=n.length,l=m==e.length,!l&&!f)return l;for(;m--;)if(c=d,v=n[m],f)for(;c--&&!(l=h(e[c],v,r,i,s,a)););else if(!(l=h(e[m],v,r,i,s,a)))break;return l}return t(n,function(t,n,o){return B.call(o,n)?(m++,l=B.call(e,n)&&h(e[n],t,r,i,s,a)):void 0}),l&&!f&&t(e,function(e,t,n){return B.call(n,t)?l=-1<--m:void 0}),v&&(o(s),o(a)),l}function p(e){return typeof e=="function"}function d(e){return!(!e||!O[typeof e])}function v(e,t,n){if(t&&typeof n=="undefined"&&X(e)){n=-1;for(var r=e.length;++n<r&&false!==t(e[n],n,e););}else if(e)if(t=t&&typeof n=="undefined"?t:u.createCallback(t,n),r=e.length,n=-1,typeof r=="number")for(;++n<r&&false!==t(e[n],n,e););else for(n in r=typeof e=="function",e)if((!r||"prototype"!=n)&&B.call(e,n)&&false===t(e[n],n,e))break;return e}function m(e,t){return W.fastBind||I&&2<arguments.length?I.call.apply(I,arguments):a(e,t,z.call(arguments,2))}function g(e){return e}var y=[],b=0,w={},E=40,S="[object Arguments]",x="[object Array]",T="[object Boolean]",N="[object Date]",C="[object Number]",k="[object Object]",L="[object RegExp]",A="[object String]",O={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,"undefined":!1},M=O[typeof global]&&global;!M||M.global!==M&&M.window!==M||(e=M);var _=[],M=Error.prototype,D=Object.prototype,P=RegExp("^"+(D.valueOf+"").replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),H=_.concat,B=D.hasOwnProperty,j=D.propertyIsEnumerable,F=D.toString,I=P.test(I=F.bind)&&I,q=P.test(q=Object.create)&&q,R=P.test(R=Array.isArray)&&R,U=P.test(U=Object.keys)&&U,z=_.slice;e=P.test(e.attachEvent),e=I&&!/\n|true/.test(I+e);var W=u.support={};W.enumErrorProps=j.call(M,"message")||j.call(M,"name"),W.enumPrototypes=!0,W.fastBind=I&&!e,W.nonEnumArgs=!0,q||(f=function(e){if(d(e)){s.prototype=e;var t=new s;s.prototype=null}return t||{}});var X=R||function(e){return e?typeof e=="object"&&F.call(e)==x:!1},V=U?function(e){return d(e)?W.enumPrototypes&&typeof e=="function"||W.nonEnumArgs&&e.length&&l(e)?i(e):U(e):[]}:i;p(/x/)&&(p=function(e){return typeof e=="function"&&"[object Function]"==F.call(e)}),u.assign=r,u.bind=m,u.bindAll=function(e){for(var t=1<arguments.length?H.apply(_,z.call(arguments,1)):c(e),n=-1,r=t.length;++n<r;){var i=t[n];e[i]=m(e[i],e)}return e},u.createCallback=function(e,t,n){if(null==e)return g;var r=typeof e;if("function"!=r){if("object"!=r)return function(t){return t[e]};var i=V(e);return function(t){for(var n=i.length,r=!1;n--&&(r=h(t[i[n]],e[i[n]],w)););return r}}return typeof t=="undefined"?e:1===n?function(n){return e.call(t,n)}:2===n?function(n,r){return e.call(t,n,r)}:4===n?function(n,r,i,s){return e.call(t,n,r,i,s)}:function(n,r,i){return e.call(t,n,r,i)}},u.defaults=function(e,t,n){var r,i=e,s=i;if(!i)return s;for(var o=arguments,u=0,a=typeof n=="number"?2:o.length;++u<a;)if((i=o[u])&&O[typeof i]){var f=i.length;if(r=-1,f&&l(i))for(;++r<f;)r+="","undefined"==typeof s[r]&&(s[r]=i[r]);else for(r in f=typeof i=="function",i)f&&"prototype"==r||!B.call(i,r)||"undefined"==typeof s[r]&&(s[r]=i[r])}return s},u.forEach=v,u.forIn=t,u.functions=c,u.invoke=function(e,t){var n=z.call(arguments,2),r=-1,i=typeof t=="function",s=e?e.length:0,o=Array(typeof s=="number"?s:0);return v(e,function(e){o[++r]=(i?t:e[t]).apply(e,n)}),o},u.keys=V,u.once=function(e){var t,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}},u.values=function(e){for(var t=-1,n=V(e),r=n.length,i=Array(r);++t<r;)i[t]=e[n[t]];return i},u.each=v,u.extend=r,u.methods=c,u.identity=g,u.isArguments=l,u.isArray=X,u.isEqual=h,u.isFunction=p,u.isObject=d,u.isString=function(e){return typeof e=="string"||F.call(e)==A},u.uniqueId=function(e){var t=++b;return(null==e?"":e)+""+t},u.VERSION="1.3.1",typeof n=="function"&&typeof n.amd=="object"&&n.amd&&n("underscore",[],function(){return u})}(this);n("browserutils",{supportHTML5Audio:function(){var e;try{if(window.HTMLAudioElement&&typeof Audio!=="undefined"){e=new Audio;return true}}catch(t){return false}},supportSourceSwappingWithPreload:function(){return/Firefox/i.test(navigator.userAgent)},isMobile:function(e){var t=window.navigator.userAgent,n=["mobile","iPhone","iPad","iPod","Android","Skyfire"];return n.some(function(e){e=new RegExp(e,"i");return e.test(t)})},canPlayType:function(e){var t=document.createElement("audio");if(!t||!t.canPlayType){return false}else{return t.canPlayType(e).match(/maybe|probably/i)?true:false}},isNativeHlsSupported:function(){var e=navigator.userAgent,t=["iPhone","iPad","iPod"],n,r,i;n=function(t){return t.test(e)};r=!n(/chrome/i)&&!n(/opera/i)&&n(/safari/i);i=t.some(function(e){return n(new RegExp(e,"i"))});return i||r}});n("errors",{FLASH_HLS_PLAYLIST_NOT_FOUND:"HLS_PLAYLIST_NOT_FOUND",FLASH_HLS_PLAYLIST_SECURITY_ERROR:"HLS_SECURITY_ERROR",FLASH_HLS_NOT_VALID_PLAYLIST:"HLS_NOT_VALID_PLAYLIST",FLASH_HLS_NO_TS_IN_PLAYLIST:"HLS_NO_TS_IN_PLAYLIST",FLASH_HLS_NO_PLAYLIST_IN_MANIFEST:"HLS_NO_PLAYLIST_IN_MANIFEST",FLASH_HLS_TS_IS_CORRUPT:"HLS_TS_IS_CORRUPT",FLASH_HLS_FLV_TAG_CORRUPT:"HLS_FLV_TAG_CORRUPT",FLASH_HTTP_FILE_NOT_FOUND:"HTTP_FILE_NOT_FOUND",FLASH_RTMP_CONNECT_FAILED:"RTMP_CONNECT_FAILED",FLASH_RTMP_CONNECT_CLOSED:"RTMP_CONNECT_CLOSED",FLASH_RTMP_CANNOT_PLAY_STREAM:"RTMP_CANNOT_PLAY_STREAM",FLASH_PROXY_CANT_LOAD_FLASH:"CANT_LOAD_FLASH",FLASH_PROXY_FLASH_BLOCKED:"FLASH_PROXY_FLASH_BLOCKED",HTML5_AUDIO_ABORTED:"HTML5_AUDIO_ABORTED",HTML5_AUDIO_NETWORK:"HTML5_AUDIO_NETWORK",HTML5_AUDIO_DECODE:"HTML5_AUDIO_DECODE",HTML5_AUDIO_SRC_NOT_SUPPORTED:"HTML5_AUDIO_SRC_NOT_SUPPORTED",HTML5_AUDIO_ENDED_EARLY:"HTML5_AUDIO_ENDED_EARLY",HTML5_AUDIO_OVERRUN:"HTML5_AUDIO_OVERRUN"});n("vendor/events",["require","exports","module","underscore"],function(e,t,n){var r=e("underscore");var i=[];var s=i.push;var o=i.slice;var u=i.splice;var a=/\s+/;var f=function(e,t,n,r){if(!n)return true;if(typeof n==="object"){for(var i in n){e[t].apply(e,[i,n[i]].concat(r))}}else if(a.test(n)){var s=n.split(a);for(var o=0,u=s.length;o<u;o++){e[t].apply(e,[s[o]].concat(r))}}else{return true}};var l=function(e,t){var n,r=-1,i=e.length;switch(t.length){case 0:while(++r<i){n=e[r];n.callback.call(n.ctx)}return;case 1:while(++r<i)(n=e[r]).callback.call(n.ctx,t[0]);return;case 2:while(++r<i)(n=e[r]).callback.call(n.ctx,t[0],t[1]);return;case 3:while(++r<i)(n=e[r]).callback.call(n.ctx,t[0],t[1],t[2]);return;default:while(++r<i)(n=e[r]).callback.apply(n.ctx,t)}};var c={on:function(e,t,n){if(!f(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);r.push({callback:t,context:n,ctx:n||this});return this},once:function(e,t,n){if(!f(this,"once",e,[t,n])||!t)return this;var i=this;var s=r.once(function(){i.off(e,s);t.apply(this,arguments)});s._callback=t;return this.on(e,s,n)},off:function(e,t,n){var i,s,o,u,a,l,c,h;if(!this._events||!f(this,"off",e,[t,n]))return this;if(!e&&!t&&!n){this._events={};return this}u=e?[e]:r.keys(this._events);for(a=0,l=u.length;a<l;a++){e=u[a];if(o=this._events[e]){this._events[e]=i=[];if(t||n){for(c=0,h=o.length;c<h;c++){s=o[c];if(t&&t!==s.callback&&t!==s.callback._callback||n&&n!==s.context){i.push(s)}}}if(!i.length)delete this._events[e]}}return this},trigger:function(e,t){if(!this._events)return this;var t=o.call(arguments,1);if(!f(this,"trigger",e,t))return this;var n=this._events[e];var r=this._events.all;if(n)l(n,t);if(r)l(r,arguments);return this},stopListening:function(e,t,n){var r=this._listeners;if(!r)return this;var i=!t&&!n;if(typeof t==="object")n=this;if(e)(r={})[e._listenerId]=e;for(var s in r){r[s].off(t,n,this);if(i)delete this._listeners[s]}return this}};var h={listenTo:"on",listenToOnce:"once"};r.each(h,function(e,t){c[t]=function(t,n,i){var s=this._listeners||(this._listeners={});var o=t._listenerId||(t._listenerId=r.uniqueId("l"));s[o]=t;if(typeof n==="object")i=this;t[e](n,i,this);return this}});c.bind=c.on;c.unbind=c.off;n.exports=c});n("states",{PLAYING:"playing",LOADING:"loading",SEEKING:"seeking",PAUSED:"paused",ERROR:"error",IDLE:"idle",INITIALIZE:"initialize",ENDED:"ended",DEAD:"dead"});n("logger",["require","exports","module"],function(e,t,n){var r;n.exports=r=function(e,t,n){this.enabled=n.debug;this.type=e;this.id=t};r.prototype.log=function(e){if(!this.enabled){return}window.console.log("#"+this.type+" "+this.id+"# "+e)}});n("html5audioplayer",["require","exports","module","underscore","vendor/events","states","errors","logger"],function(e,t,n){var r,i=e("underscore"),s=e("vendor/events"),o=e("states"),u=e("errors"),a=e("logger");n.exports=r=function(e,t){this._id=e.id;this._descriptor=e;this._isLoaded=false;this._settings=t;this._bufferingTimeout=null;this._currentPosition=0;this._loadedPosition=0;this._prevCurrentPosition=0;this._prevCheckTime=0;this._prevComparison=0;this._positionUpdateTimer=0;this._playRequested=false;this._startFromPosition=0;if(e.duration){this._duration=e.duration}i.bindAll(this,"_onPositionChange","_onStateChange","_onLoaded","_onBuffering");this._init();this.toggleEventListeners(true);if(this._descriptor.preload){this.preload()}if(e.autoPlay){this.play()}else{this._setState(o.IDLE)}};i.extend(r.prototype,s);r.prototype._init=function(){this._html5Audio=new Audio;this._html5Audio.mozAudioChannelType="content";this._html5Audio.id=this._settings.audioObjectID+"_"+this._descriptor.id;this._html5Audio.preload="none";this._logger=new a(this.getType(),this._id,this._settings)};r.prototype.getId=function(){return this._id};r.prototype.getType=function(){return"HTML5 audio"};r.prototype.play=function(e){if(this.isInOneOfStates(o.ERROR,o.DEAD)){return}if(this.isInOneOfStates(o.PAUSED,o.ENDED)){this.resume();return}this._logger.log("play");this._startFromPosition=e||0;this._setState(o.LOADING);this._playRequested=true;var t=function(){if(!this._playRequested){return}this._trySeekToStartPosition();this._html5Audio.play();clearInterval(this._positionUpdateTimer);this._positionUpdateTimer=setInterval(this._onPositionChange,this._settings.updateInterval)};if(this._isLoaded){t.apply(this)}else{this.preload();this.once("loaded",t)}};r.prototype._trySeekToStartPosition=function(){var e;if(this._startFromPosition>0){this._logger.log("seek to start position="+this._startFromPosition);e=this._startFromPosition/1e3;this._html5Audio.currentTime=e;if(this._html5Audio.currentTime===e){this._startFromPosition=0;return true}}return false};r.prototype.pause=function(){this._playRequested=false;if(this.isInOneOfStates(o.ERROR,o.DEAD)){return}this._logger.log("pause");this._html5Audio.pause();clearTimeout(this._bufferingTimeout);clearInterval(this._positionUpdateTimer)};r.prototype.seek=function(e){var t=false,n,r=this._html5Audio.seekable,i;if(this.isInOneOfStates(o.ERROR,o.DEAD)){return}if(!this._isLoaded){this.once("loaded",function(){this.seek(e)});return}n=e/1e3;for(i=0;i<r.length;i++){if(n<=r.end(i)&&n>=r.start(i)){t=true;break}}if(!t){return}this._logger.log("seek");this._setState(o.SEEKING);this._html5Audio.currentTime=e/1e3;clearTimeout(this._bufferingTimeout)};r.prototype.resume=function(){if(this.isInOneOfStates(o.ERROR,o.DEAD)){return}this._logger.log("resume");if(this.getState()===o.PAUSED){this._setState(o.LOADING);this._html5Audio.play(this._html5Audio.currentTime)}else if(this.getState()===o.ENDED){this._setState(o.LOADING);this._html5Audio.play(0)}clearInterval(this._positionUpdateTimer);this._positionUpdateTimer=setInterval(this._onPositionChange,this._settings.updateInterval)};r.prototype.setVolume=function(e){if(!this._html5Audio){return}this._html5Audio.volume=e};r.prototype.getVolume=function(){if(!this._html5Audio){return 1}return this._html5Audio.volume};r.prototype.setMute=function(e){if(!this._html5Audio){return}this._html5Audio.muted=e};r.prototype.getMute=function(){if(!this._html5Audio){return false}return this._html5Audio.muted};r.prototype.getState=function(){return this._state};r.prototype.getCurrentPosition=function(){return this._currentPosition};r.prototype.getLoadedPosition=function(){return this._loadedPosition};r.prototype.getDuration=function(){return this._duration};r.prototype.kill=function(){if(this._state===o.DEAD){return}clearInterval(this._positionUpdateTimer);clearTimeout(this._bufferingTimeout);this._playRequested=false;this.toggleEventListeners(false);this._html5Audio.pause();this._html5Audio.src=null;delete this._html5Audio;this._setState(o.DEAD)};r.prototype.getErrorMessage=function(){return this._errorMessage};r.prototype.getErrorID=function(){return this._errorID};r.prototype.preload=function(){var e=this._html5Audio;if(e.preload!=="auto"){this._logger.log("preload");e.preload="auto";e.type=this._descriptor.mimeType;e.src=this._descriptor.src;e.load()}};r.prototype._setState=function(e){if(this._state===e){return}this._logger.log('state changed "'+e+'"');this._state=e;this.trigger("stateChange",e,this)};r.prototype.toggleEventListeners=function(e){if(!this._html5Audio){return}var t=e?"addEventListener":"removeEventListener";["ended","play","playing","pause","seeking","waiting","seeked","error"].forEach(function(e){this._html5Audio[t](e,this._onStateChange)},this);this._html5Audio[t]("loadedmetadata",this._onLoaded)};r.prototype.isInOneOfStates=function(){for(var e in arguments){if(arguments[e]===this._state){return true}}return false};r.prototype.updatePositions=function(){this._currentPosition=this._html5Audio.currentTime*1e3;if(this._html5Audio.seekable.length>0){this._loadedPosition=this._html5Audio.seekable.end(0)*1e3}};r.prototype._onBuffering=function(){this._setState(o.LOADING)};r.prototype._onLoaded=function(e){if(this._duration===undefined||this._duration===0){this._duration=this._html5Audio.duration*1e3}this._isLoaded=true;this._logger.log('html5 audio event "'+e.type+'"');this.trigger("loaded",this)};r.prototype._onPositionChange=function(e){this.updatePositions();this.trigger("positionChange",this._currentPosition,this._loadedPosition,this._duration,this);if(!this.isInOneOfStates(o.PLAYING,o.LOADING)){return}if(this._duration!==0&&this._currentPosition>this._duration){this._errorID=u.HTML5_AUDIO_OVERRUN;this._errorMessage=this._getErrorMessage(this._errorID);this._logger.log("html5 audio error: "+this._errorID+" "+this._errorMessage);this._setState(o.ERROR);this.toggleEventListeners(false);return}var t=(new Date).valueOf(),n=this._currentPosition-this._prevCurrentPosition,r=t-this._prevCheckTime,i;if(r===0){return}i=n/r;if(i>.7){clearTimeout(this._bufferingTimeout);this._setState(o.PLAYING);this._bufferingTimeout=null}else if(this._state===o.PLAYING&&this._bufferingTimeout==null){this._bufferingTimeout=setTimeout(this._onBuffering,this._settings.bufferingDelay)}this._prevCurrentPosition=this._currentPosition;this._prevCheckTime=t};r.prototype._onStateChange=function(e){this._logger.log('html5 audio event "'+e.type+'"');clearTimeout(this._bufferingTimeout);switch(e.type){case"playing":if(this._trySeekToStartPosition()){return}this.updatePositions();this._setState(o.PLAYING);break;case"pause":this._setState(o.PAUSED);break;case"ended":this._currentPosition=this._loadedPosition=this._duration;this.trigger("positionChange",this._currentPosition,this._loadedPosition,this._duration,this);this._setState(o.ENDED);clearInterval(this._positionUpdateTimer);break;case"waiting":if(this.getState()===o.SEEKING){break}this._setState(o.LOADING);break;case"seeking":this._setState(o.SEEKING);break;case"seeked":this.updatePositions();if(this._html5Audio.paused){this._setState(o.PAUSED)}else{this._setState(o.PLAYING)}break;case"error":this._errorID={1:u.HTML5_AUDIO_ABORTED,2:u.HTML5_AUDIO_NETWORK,3:u.HTML5_AUDIO_DECODE,4:u.HTML5_AUDIO_SRC_NOT_SUPPORTED}[this._html5Audio.error.code];this._errorMessage=this._getErrorMessage(this._errorID);this._logger.log("html5 audio error: "+this._errorID+" "+this._errorMessage);this._setState(o.ERROR);this.toggleEventListeners(false);break}};r.prototype._getErrorMessage=function(e){var t={};t[u.HTML5_AUDIO_ABORTED]="The fetching process was aborted by the user.";t[u.HTML5_AUDIO_NETWORK]="A network connection lost.";t[u.HTML5_AUDIO_DECODE]="An error occurred while decoding the media resource.";t[u.HTML5_AUDIO_SRC_NOT_SUPPORTED]="The media resource is not suitable.";t[u.HTML5_AUDIO_ENDED_EARLY]="Audio playback ended before the indicated duration of the track.";t[u.HTML5_AUDIO_OVERRUN]="Audio playback continued past end of the track.";return t[e]}});n("hlsaudioplayer",["require","exports","module","underscore","errors","vendor/events","html5audioplayer","logger","states"],function(e,t,n){var r,i=e("underscore"),s=e("errors"),o=e("vendor/events"),u=e("html5audioplayer"),a=e("logger"),f=e("states"),l=1;n.exports=r=function(e,t){u.apply(this,arguments);this._seekPosition=0};i.extend(r.prototype,u.prototype);r.prototype.getType=function(){return"HTML5 HLS audio"};r.prototype.seek=function(e){u.prototype.seek.apply(this,arguments);if(this.isInOneOfStates(f.LOADING)){this._seekPosition=e}};r.prototype.getCurrentPosition=function(){if(this.isInOneOfStates(f.LOADING)&&this._seekPosition>0){return this._seekPosition}return u.prototype.getCurrentPosition.apply(this,arguments)};r.prototype._onStateChange=function(e){this._logger.log('hls html5 audio event "'+e.type+'"');clearTimeout(this._bufferingTimeout);switch(e.type){case"playing":this.updatePositions();this._seekPosition=0;this._setState(f.PLAYING);break;case"pause":this._setState(f.PAUSED);break;case"ended":if(this._currentPosition+l<this._duration){this._errorID=s.HTML5_AUDIO_ENDED_EARLY;this._errorMessage=this._getErrorMessage(this._errorID);this._logger.log("html5 audio error: "+this._errorID+" "+this._errorMessage);this._setState(f.ERROR);this.toggleEventListeners(false);break}this._currentPosition=this._loadedPosition=this._duration;this.trigger("positionChange",this._currentPosition,this._loadedPosition,this._duration,this);this._setState(f.ENDED);clearInterval(this._positionUpdateTimer);break;case"waiting":this._setState(f.LOADING);break;case"seeking":this._setState(f.SEEKING);break;case"seeked":this.updatePositions();if(this._html5Audio.paused){this._setState(f.PAUSED)}break;case"error":this._errorID={1:s.HTML5_AUDIO_ABORTED,2:s.HTML5_AUDIO_NETWORK,3:s.HTML5_AUDIO_DECODE,4:s.HTML5_AUDIO_SRC_NOT_SUPPORTED}[this._html5Audio.error.code];this._errorMessage=this._getErrorMessage(this._errorID);this._logger.log("html5 audio error: "+this._errorID+" "+this._errorMessage);this._setState(f.ERROR);this.toggleEventListeners(false);break}}});n("singleaudioplayer",["require","exports","module","underscore","browserutils","errors","vendor/events","html5audioplayer","logger","states"],function(e,t,n){function h(e){function t(t,n){var r=c[e._playerId];Object.keys(c).forEach(function(e){var t=c[e];if(t!==r){if(t.isInOneOfStates(l.PLAYING,l.LOADING)){t.pause()}}});if(r){r[t](n)}}var n=t.bind(null,"_onStateChange"),r=t.bind(null,"_onLoaded");["ended","play","playing","pause","seeking","waiting","seeked","error"].forEach(function(t){e.addEventListener(t,n)},this);e.addEventListener("loadedmetadata",r)}var r,i=e("underscore"),s=e("browserutils"),o=e("errors"),u=e("vendor/events"),a=e("html5audioplayer"),f=e("logger"),l=e("states"),c={};n.exports=r=function(e,t){a.apply(this,arguments)};i.extend(r.prototype,a.prototype);r.prototype._init=function(){if(!r._html5Audio){var e=new Audio;e.mozAudioChannelType="content";e.id=this._settings.audioObjectID+"_Single";e.preload="none";r._html5Audio=e;this._preloadAudio=e;h(e)}this._html5Audio=r._html5Audio;this._playRequested=false;this._logger=new f(this.getType(),this._id,this._settings)};r.prototype.toggleEventListeners=function(e){if(e){c[this._id]=this}else{delete c[this._id]}};r.prototype.getType=function(){return"HTML5 single audio"};r.prototype.play=function(e){this._playRequested=true;if(this._html5Audio._playerId===this._descriptor.id&&this.isInOneOfStates(l.PAUSED,l.ENDED)){a.prototype.resume.apply(this,arguments);return}if(this.isInOneOfStates(l.PAUSED)){e=this._currentPosition}this._startFromPosition=e||0;this._html5Audio._playerId=this._descriptor.id;this.toggleEventListeners(true);this._setState(l.LOADING);var t=function(){if(!this._playRequested){return}this._logger.log("play after loaded");this._trySeekToStartPosition();this._html5Audio.play();clearInterval(this._positionUpdateTimer);this._positionUpdateTimer=setInterval(this._onPositionChange,this._settings.updateInterval)};if(this._html5Audio.readyState>0&&this._descriptor.src===this._html5Audio.src){t.apply(this)}else{this.once("loaded",t);this._html5Audio.type=this._descriptor.mimeType;this._html5Audio.src=this._descriptor.src;this._html5Audio.preload="auto";this._html5Audio.load()}};r.prototype.pause=function(){this._playRequested=false;if(this.isInOneOfStates(l.ERROR,l.DEAD)){return}this._logger.log("pause");if(this._html5Audio._playerId===this._descriptor.id){this._html5Audio.pause()}else{this.toggleEventListeners(false);this._setState(l.PAUSED)}clearTimeout(this._bufferingTimeout);clearInterval(this._positionUpdateTimer)};r.prototype.seek=function(e){if(this._html5Audio._playerId!==this._descriptor.id){this._currentPosition=e;this.trigger("positionChange",this._currentPosition,this._loadedPosition,this._duration,this);return}a.prototype.seek.apply(this,arguments)};r.prototype.kill=function(){if(this._state===l.DEAD){return}this._playRequested=false;clearInterval(this._positionUpdateTimer);clearTimeout(this._bufferingTimeout);this.toggleEventListeners(false);this._setState(l.DEAD)};r.prototype.resume=function(){if(this.isInOneOfStates(l.ERROR,l.DEAD)){return}if(this._html5Audio._playerId!==this._descriptor.id){this.play(this._currentPosition);return}a.prototype.resume.apply(this,arguments)};r.prototype.preload=function(){if(!this._preloadAudio&&s.supportSourceSwappingWithPreload()){this._preloadAudio=new Audio;this._preloadAudio.preload="none"}var e=this._preloadAudio;if(e&&e.preload!=="auto"){this._logger.log("preload");e.preload="auto";e._playerId=this._id;e.type=this._descriptor.mimeType;e.src=this._descriptor.src;e.load()}}});n("hlssingleaudioplayer",["require","exports","module","underscore","errors","vendor/events","hlsaudioplayer","logger","singleaudioplayer","states"],function(e,t,n){var r,i=e("underscore"),s=e("errors"),o=e("vendor/events"),u=e("hlsaudioplayer"),a=e("logger"),f=e("singleaudioplayer"),l=e("states");n.exports=r=function(e,t){f.apply(this,arguments)};i.extend(r.prototype,f.prototype);r.prototype.getType=function(){return"HTML5 HLS single audio"}});n("mimetypes",{AAC:"audio/aac",M3U8:"application/x-mpegURL",MP4:"audio/mp4",MPEG:"audio/mpeg",OGG:"audio/ogg",WAV:"audio/wav",WEBM:"audio/webm",getTypeByExtension:function(e){var t={mp1:this.MPEG,mp2:this.MPEG,mp3:this.MPEG,mpeg:this.MPEG,mpg:this.MPEG,aac:this.AAC,mp4:this.MP4,ogg:this.OGG,oga:this.OGG,opus:this.OGG,webm:this.WEBM,wav:this.WAV,m3u8:this.M3U8};return t[e]||null}});n("factory",["require","exports","module","browserutils","hlssingleaudioplayer","mimetypes","singleaudioplayer"],function(e,t,n){var r,i=e("browserutils"),s=e("hlssingleaudioplayer"),o=e("mimetypes"),u=e("singleaudioplayer");n.exports=r=function(){};r.createAudioPlayer=function(e,t){var n,a,f,l;a=e.src.split(":")[0];if(a==="rtmp"||a==="rtmpt"){return null}else{n=r.getMimeType(e);if(n===o.M3U8){if(i.isNativeHlsSupported()){l=new s(e,t)}else{return null}}else if(i.supportHTML5Audio()&&i.canPlayType(n)){l=new u(e,t)}else{return null}}return l};r.getMimeType=function(e){if(e.mimeType){return e.mimeType}var t=e.src.split("?")[0];t=t.substring(t.lastIndexOf(".")+1,t.length);return o.getTypeByExtension(t)}});n("audiomanager",["require","exports","module","underscore","factory","states","errors","browserutils"],function(e,t,n){var r,i=e("underscore"),s=e("factory"),o=e("states"),u=e("errors"),a=e("browserutils");n.exports=r=function(e){e=e||{};this._players={};this._volume=1;this._mute=false;this._settings=i.defaults(e,r.defaults)};r.States=o;r.Errors=u;r.BrowserUtils=a;r.defaults={flashAudioPath:"flashAudio.swf",flashLoadTimeout:2e3,flashObjectID:"flashAudioObject",audioObjectID:"html5AudioObject",updateInterval:300,bufferTime:8e3,bufferingDelay:800,debug:false};r.prototype.getAudioPlayer=function(e){return this._players[e]};r.prototype.hasAudioPlayer=function(e){return this._players[e]!==undefined};r.prototype.removeAudioPlayer=function(e){if(this.hasAudioPlayer(e)){delete this._players[e]}};r.prototype.setVolume=function(e){e=Math.min(1,e);this._volume=Math.max(0,e);for(var t in this._players){if(this._players.hasOwnProperty(t)){this._players[t].setVolume(this._volume)}}};r.prototype.getVolume=function(){return this._volume};r.prototype.setMute=function(e){this._muted=e;for(var t in this._players){if(this._players.hasOwnProperty(t)){this._players[t].setMute(this._muted)}}};r.prototype.getMute=function(){return this._muted};r.prototype.createAudioPlayer=function(e){var t,n,r;if(!e.id){e.id=Math.floor(Math.random()*1e10).toString()+(new Date).getTime().toString()}if(!e.src){throw new Error("AudioManager: You need to pass a valid src")}if(!this._players[e.id]){this._players[e.id]=s.createAudioPlayer(e,this._settings)}this._players[e.id].setVolume(this._volume);this._players[e.id].setMute(this._muted);this._players[e.id].on("stateChange",this._onStateChange,this);return this._players[e.id]};r.prototype._onStateChange=function(e,t){if(t.getState()===o.DEAD){this.removeAudioPlayer(t.getId())}}});t(["audiomanager"]);return t("audiomanager")})
